<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Metronome Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050509;
      --card-bg: #0e0e16;
      --accent: #ffffff;
      --accent-soft: #3a3a4a;
      --accent-muted: #8a8aa0;
      --danger: #ff4b4b;
      --radius: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #141424 0, #050509 60%);
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .wrapper {
      width: 100%;
      max-width: 420px;
    }

    .card {
      background: linear-gradient(145deg, #0d0d15, #06060c);
      border-radius: var(--radius);
      padding: 20px 18px 18px;
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-muted);
    }

    .indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-muted);
    }

    .indicator-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent-soft);
      opacity: 0.5;
      transition: opacity 0.1s ease, transform 0.08s ease, background 0.1s ease;
    }

    .indicator-dot.active {
      opacity: 1;
      transform: scale(1.5);
      background: #ffffff;
    }

    .main {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 4px;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .bpm-block { flex: 1.4; }
    .ts-block { flex: 1; }

    .bpm-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .bpm-label,
    .ts-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-muted);
      margin-bottom: 4px;
    }

    .bpm-display {
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .bpm-value {
      font-size: 32px;
      font-weight: 500;
      letter-spacing: 0.1em;
      min-width: 72px;
      text-align: right;
    }

    .bpm-unit {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-muted);
    }

    .bpm-controls {
      display: flex;
      gap: 6px;
    }

    .btn-round {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: rgba(255, 255, 255, 0.02);
      color: var(--accent);
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.08s ease;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
    }

    .bpm-slider-row { margin-top: 4px; }

/* Slider container */
.bpm-slider {
  -webkit-appearance: none;
  width: 100%;
  height: 6px;
  background: transparent;
  cursor: pointer;
  outline: none;
}

/* TRACK — Chrome */
.bpm-slider::-webkit-slider-runnable-track {
  height: 6px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.12); /* trilho suave */
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.6);
}

/* THUMB — Chrome */
.bpm-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ffffff;
  box-shadow:
    0 4px 12px rgba(255, 255, 255, 0.25),
    0 0 0 4px rgba(255, 255, 255, 0.1);
  margin-top: -6px; /* centralizar */
  transition: 0.15s ease;
}

/* Hover */
.bpm-slider::-webkit-slider-thumb:hover {
  transform: scale(1.2);
}

/* TRACK — Firefox */
.bpm-slider::-moz-range-track {
  height: 6px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.12);
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.6);
}

/* PROGRESS — Firefox */
.bpm-slider::-moz-range-progress {
  background: rgba(255, 255, 255, 0.25);
  height: 6px;
  border-radius: 10px;
}

/* THUMB — Firefox */
.bpm-slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ffffff;
  box-shadow:
    0 4px 12px rgba(255, 255, 255, 0.25),
    0 0 0 4px rgba(255, 255, 255, 0.1);
  transition: 0.15s ease;
}

/* Hover Firefox */
.bpm-slider::-moz-range-thumb:hover {
  transform: scale(1.2);
}


    .time-select {
      width: 100%;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: #090912;
      color: var(--accent);
      font-size: 12px;
      outline: none;
      cursor: pointer;
    }

    .beat-visualizer {
      margin-top: 10px;
      display: flex;
      gap: 6px;
      justify-content: center;
    }

    .beat-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #23233a;
      opacity: 0.5;
      transition: 0.1s ease;
    }

    .beat-dot.active {
      opacity: 1;
      transform: scale(1.4);
      background: #ffffff;
    }

    .beat-dot.accent {
      background: #545496;
    }

    .bottom-row {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      gap: 10px;
    }

    .btn-main {
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 11px;
      text-transform: uppercase;
      cursor: pointer;
      background: #ffffff;
      color: #050509;
      font-weight: 600;
      letter-spacing: 0.18em;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-main.secondary {
      background: transparent;
      border: 1px solid var(--accent-soft);
      color: var(--accent-muted);
      box-shadow: none;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .checkbox-row input {
      width: 12px;
      height: 12px;
      accent-color: #ffffff;
    }

    .options {
      margin-top: 8px;
      font-size: 10px;
      color: var(--accent-muted);
      letter-spacing: 0.14em;
    }
  </style>
</head>
<body>

<div class="wrapper">
  <div class="card">
    <div class="header">
      <div class="title">Metronome Pro</div>
      <div class="indicator">
        <div class="indicator-dot" id="status-indicator"></div>
        <span id="status-label">Idle</span>
      </div>
    </div>

    <div class="main">

      <div class="top-row">
        <div class="bpm-block">
          <div class="bpm-label">Tempo</div>
          <div class="bpm-row">
            <div class="bpm-display">
              <div class="bpm-value" id="bpm-value">100</div>
              <div class="bpm-unit">BPM</div>
            </div>
            <div class="bpm-controls">
              <button class="btn-round" id="bpm-down">−</button>
              <button class="btn-round" id="bpm-up">+</button>
            </div>
          </div>
        </div>

        <div class="ts-block">
          <div class="ts-label">Compasso</div>
          <select id="time-signature" class="time-select">
            <option value="2">2/4</option>
            <option value="3">3/4</option>
            <option value="4" selected>4/4</option>
            <option value="5">5/4</option>
            <option value="7">7/8</option>
          </select>
        </div>
      </div>

      <div class="bpm-slider-row">
        <input type="range" min="40" max="240" value="100" class="bpm-slider" id="bpm-slider" />
      </div>

      <div class="beat-visualizer" id="beat-visualizer"></div>

      <div class="bottom-row">
        <button class="btn-main" id="start-stop"><span>▶</span> <span id="start-stop-label">Start</span></button>
        <button class="btn-main secondary" id="reset">Reset</button>
      </div>

      <label class="checkbox-row options">
        <input type="checkbox" id="accent-toggle" checked />
        Acentuar 1º tempo
      </label>

    </div>
  </div>
</div>

<script>
  let audioCtx = null;
  let isRunning = false;
  let currentBeat = 0;
  let beatsPerBar = 4;

  let bpm = 100;
  let nextNoteTime = 0;
  const scheduleAheadTime = 0.1;
  const lookahead = 25;
  let timerID = null;

  const bpmEl = document.getElementById("bpm-value");
  const sliderEl = document.getElementById("bpm-slider");
  const tsEl = document.getElementById("time-signature");
  const accentEl = document.getElementById("accent-toggle");
  const viz = document.getElementById("beat-visualizer");

  let dots = [];

  function rebuildDots() {
    viz.innerHTML = "";
    dots = [];
    for (let i = 0; i < beatsPerBar; i++) {
      const dot = document.createElement("div");
      dot.className = "beat-dot" + (i === 0 ? " accent" : "");
      viz.appendChild(dot);
      dots.push(dot);
    }
  }

  function scheduleClick(time, accent) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.frequency.value = accent ? 2000 : 1300;
    gain.gain.setValueAtTime(0, time);
    gain.gain.linearRampToValueAtTime(1, time + 0.001);
    gain.gain.exponentialRampToValueAtTime(0.001, time + 0.07);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(time);
    osc.stop(time + 0.08);
  }

  function nextNote() {
    const sec = 60 / bpm;
    nextNoteTime += sec;
    currentBeat = (currentBeat + 1) % beatsPerBar;
  }

  function scheduler() {
    while (nextNoteTime < audioCtx.currentTime + scheduleAheadTime) {
      const accent = accentEl.checked && currentBeat === 0;
      scheduleClick(nextNoteTime, accent);

      dots.forEach((d, i) => d.classList.toggle("active", i === currentBeat));

      nextNote();
    }
    timerID = setTimeout(scheduler, lookahead);
  }

  document.getElementById("start-stop").onclick = () => {
    if (!isRunning) {
      if (!audioCtx) audioCtx = new AudioContext();
      nextNoteTime = audioCtx.currentTime + 0.05;
      currentBeat = 0;
      isRunning = true;
      scheduler();
      document.getElementById("start-stop-label").innerText = "Stop";
    } else {
      isRunning = false;
      clearTimeout(timerID);
      document.getElementById("start-stop-label").innerText = "Start";
      dots.forEach(d => d.classList.remove("active"));
    }
  };

  document.getElementById("reset").onclick = () => {
    bpm = 100;
    beatsPerBar = 4;
    tsEl.value = "4";
    bpmEl.innerText = 100;
    sliderEl.value = 100;
    rebuildDots();
  };

  document.getElementById("bpm-up").onclick = () => {
    bpm = Math.min(240, bpm + 1);
    bpmEl.innerText = bpm;
    sliderEl.value = bpm;
  };

  document.getElementById("bpm-down").onclick = () => {
    bpm = Math.max(40, bpm - 1);
    bpmEl.innerText = bpm;
    sliderEl.value = bpm;
  };

  sliderEl.oninput = e => {
    bpm = parseInt(e.target.value);
    bpmEl.innerText = bpm;
  };

  tsEl.onchange = e => {
    beatsPerBar = parseInt(e.target.value);
    rebuildDots();
  };

  rebuildDots();
</script>

</body>
</html>
